<?xml version="1.0" encoding="utf-8"?>
<Project>
  <!-- This file is automatically imported by NuGet when the package is referenced -->

  <!-- Copy the test adapter to the output directory so VSTest can discover it -->
  <ItemGroup>
    <Content Include="$(MSBuildThisFileDirectory)../lib/net8.0/Sailfish.TestAdapter.dll" Condition="'$(TargetFramework)' == 'net8.0' and Exists('$(MSBuildThisFileDirectory)../lib/net8.0/Sailfish.TestAdapter.dll')">
      <CopyToOutputDirectory>PreserveNewest</CopyToOutputDirectory>
      <Visible>False</Visible>
    </Content>
    <Content Include="$(MSBuildThisFileDirectory)../lib/net9.0/Sailfish.TestAdapter.dll" Condition="'$(TargetFramework)' == 'net9.0' and Exists('$(MSBuildThisFileDirectory)../lib/net9.0/Sailfish.TestAdapter.dll')">
      <CopyToOutputDirectory>PreserveNewest</CopyToOutputDirectory>
      <Visible>False</Visible>
    </Content>
  </ItemGroup>

  <!-- Ensure the test adapter is available for test discovery -->
  <ItemGroup>
    <TestAdapterPath Include="$(MSBuildThisFileDirectory)../lib/net8.0/" Condition="'$(TargetFramework)' == 'net8.0'" />
    <TestAdapterPath Include="$(MSBuildThisFileDirectory)../lib/net9.0/" Condition="'$(TargetFramework)' == 'net9.0'" />
  </ItemGroup>

  <!-- Copy all Sailfish runtime dependencies to output directory -->
  <Target Name="CopySailfishDependencies" AfterTargets="ResolvePackageAssets">
    <ItemGroup>
      <!-- Copy all runtime assemblies from packages that Sailfish depends on -->
      <ContentWithTargetPath Include="@(RuntimeCopyLocalItems)"
        Condition="'%(RuntimeCopyLocalItems.NuGetPackageId)' == 'Sailfish' or
                                        '%(RuntimeCopyLocalItems.NuGetPackageId)' == 'Autofac' or
                                        '%(RuntimeCopyLocalItems.NuGetPackageId)' == 'MediatR' or
                                        '%(RuntimeCopyLocalItems.NuGetPackageId)' == 'MediatR.Extensions.Autofac.DependencyInjection' or
                                        '%(RuntimeCopyLocalItems.NuGetPackageId)' == 'CsvHelper' or
                                        '%(RuntimeCopyLocalItems.NuGetPackageId)' == 'MathNet.Numerics' or
                                        '%(RuntimeCopyLocalItems.NuGetPackageId)' == 'Perfolizer' or
                                        '%(RuntimeCopyLocalItems.NuGetPackageId)' == 'System.Linq.Async' or
                                        '%(RuntimeCopyLocalItems.NuGetPackageId)' == 'Microsoft.Extensions.Configuration' or
                                        '%(RuntimeCopyLocalItems.NuGetPackageId)' == 'Microsoft.Extensions.Configuration.Json' or
                                        '%(RuntimeCopyLocalItems.NuGetPackageId)' == 'Microsoft.Extensions.DependencyInjection.Abstractions' or
                                        '%(RuntimeCopyLocalItems.NuGetPackageId)' == 'System.Runtime.Caching' or
                                        '%(RuntimeCopyLocalItems.NuGetPackageId)' == 'System.Collections.Specialized' or
                                        '%(RuntimeCopyLocalItems.NuGetPackageId)' == 'System.Diagnostics.DiagnosticSource'">
        <CopyToOutputDirectory>PreserveNewest</CopyToOutputDirectory>
        <TargetPath Condition="'%(RuntimeCopyLocalItems.TargetPath)' != ''">%(RuntimeCopyLocalItems.TargetPath)</TargetPath>
        <TargetPath Condition="'%(RuntimeCopyLocalItems.TargetPath)' == ''">%(Filename)%(Extension)</TargetPath>
      </ContentWithTargetPath>
    </ItemGroup>
  </Target>

</Project>